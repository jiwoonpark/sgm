<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.spring.main.dao.BoardInterface">
 
 	<!-- 로그인 처리 -->
 	<select id="login" resultType="String">
 		SELECT u_id FROM USER1 
 			WHERE u_id=#{param1} AND u_pass=#{param2}
 	</select>
 	
 	<!-- 중복 체크 -->
  	<select id="overlay" resultType="String">
 		SELECT u_id FROM user1 WHERE u_id=#{param1}
 	</select>
 	
 	<!-- 회원가입 -->
 	<insert id="userJoin" parameterType="com.spring.main.dto.UserDto">
 		INSERT INTO user1(u_idx,u_id,u_pass,u_name,u_age,u_gender,u_phnum,u_mail)
 			VALUES(
 				user1_seq.NEXTVAL,#{u_id},#{u_pass},#{u_name},#{u_age},#{u_gender},#(u_phnum),#{u_mail}
 			)
 	</insert>
 		
 	<!-- 자유게시판 리스트 뛰우기 -->
 	<!-- 게시물 전채 개수 -->
   <select id="f_allCount" resultType="Integer">
      SELECT COUNT(*) FROM board
   </select>
   
   <!-- 검색 후 게시물 전채 개수 -->
   <select id="f_searhCount" resultType="Integer" >
      SELECT COUNT(*) FROM board WHERE ${param2} like '%'||#{param1}||'%'
   </select>
   
   <!-- 리스트 불러오기 -->
   <select id="f_listCall" resultType="com.spring.main.dto.freelistDTO">
      SELECT j_idx, u_idx, j_name, j_category, j_title, j_content, j_date, 
       j_filenum, j_vcount, j_reple
          FROM (
              SELECT j_idx,
              u_idx, j_name,
              j_category,
              j_title,
              j_content, 
              j_date,
              j_filenum,
              j_vcount,
              j_reple,
                 ROW_NUMBER() OVER(ORDER BY j_idx DESC)AS rnum FROM board)
      WHERE rnum BETWEEN #{param1} AND #{param2}
   </select>
   
   <!-- 검색 후 리스트 추가 -->
   <select id="f_searhCall" resultType="com.spring.main.dto.freelistDTO">
      SELECT j_idx, u_idx, j_name, j_category, j_title, j_content, j_date, 
       j_filenum, j_vcount, j_reple FROM (
         SELECT j_idx,
              u_idx, j_name,
              j_category,
              j_title,
              j_content, 
              j_date,
              j_filenum,
              j_vcount,
              j_reple, 
                 ROW_NUMBER() OVER(ORDER BY mch_idx DESC) AS rnum FROM board
        WHERE ${param4} like '%'||#{param3}||'%' )WHERE rnum BETWEEN #{param1} AND #{param2}
   </select>
   
   <!-- 상세 보기 -->
 	<select id="contentView" resultType="com.spring.main.dto.freelistDTO">
 		SELECT * FROM board WHERE j_idx = #{param1}
 	</select>

 	<!-- 글쓰기 -->
 	<insert id="write">
 		INSERT INTO board(
 		j_idx, j_title, j_name, j_content, j_vcount, j_reple)
 			VALUES(board_seq.NEXTVAL, #{param1}, #{param2}, #{param3}
 			,0,0)
 	</insert>
 	
 	
	    
</mapper>